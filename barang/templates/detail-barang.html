{% extends 'base.html' %}
{% load static %}

{% block meta %}
<title>Warung Etik</title>
<link rel="stylesheet" type="text/css" href="{% static 'css/css-barang.css' %}">
{% load humanize %}
{% endblock meta %}

{% block content %}

<div class="container min-vh-100 mt-5">

    <div class="row">
      <div class="col-12 col-lg-6 mt-5">
        <img class="rounded-3 shadow img-fluid" src="{{ barang.image_url }}" alt="">
      </div>
      <div class="col col-12 col-lg-6 mt-5">
        <h1><b>{{ barang.nama }}</b></h1>

        <div class="row mt-2 mb-2">
            <h2><b>Rp. {{ barang.harga | intcomma}}</b></h2>
        </div>

        <div class="row mt-2">
            <div class="col">
                <p>Stok tersedia: {{ barang.stok }}</p>
            </div>
            <div class="col">
                <p>Terjual: {{ barang.terjual }}</p>
            </div>
            
        </div>

        <div class="row">
        </div>

        <div class="row mt-5">
            <h3 class="align-text-bottom">Jumlah:</h3>
        </div>

        <div class="row">
            <div class="btn-group btn-quantity" role="group" aria-label="Basic mixed styles example">
                <button type="button" onclick="decrement()" class="btn btn-secondary"><b>-</b></button>
                <button type="button" style="width: 90vw; border: 0; cursor: default;"><h3 id="counting">1</h3></button>
                <button type="button" onclick="increment()" class="btn btn-secondary"><b>+</b></button>
            </div>
        </div>
        <div class="row">
            <form action="{% url 'keranjang:createItemKeranjang' %}" method="post">
                <input type="text" name="username" value="{{ request.user.username }}" hidden>
                <input type="text" name="id_barang" value="{{ barang.id }}" hidden>
                <input id="valueCount" type="text" name="jumlah_item" value="1" hidden>
                <button type="submit" class="btn-tambah btn btn-info btn-lg mt-5">Tambahkan ke keranjang</button>
            </form>
        </div>
    </div>
    </div>

    <div class="row mt-5">
        <h3>Deskripsi</h3>
    </div>
    <div class="row">
        <div class="col-12 col-lg-12">
        <p>{{ barang.deskripsi|linebreaks }}
        </p>
        </div>
    </div>

    <div id="ulasan" class="row mt-3 mb-2">
        <h1 style="font-weight: bold;">Ulasan</h1>
    </div>

    <div>
        {% for review in barang.reviews.all %}

        <div class="row mb-3">
            <div class="col-2 col-lg-1"><img class="rounded-3 shadow img-fluid mt-2" src="https://secure.gravatar.com/avatar/141270ad849615ed6de6d0824d4895ec?s=400&d=mm&r=g" alt="">
            </div>
            <div class="col-12 col-lg-8 mt-2">
                <h2>{{ review.author }}</h2>
                <p>{{ review.date }}</p>
                {% if request.user == review.author %}
                <a href="{% url 'review:edit' review.id %}">edit</a>
                {% endif %}
                <p>{{ review.content }}</p>
                
            </div>
            {% if review.bintang == 5 %}
            <div class="col-6 col-lg-2 mt-2 stars">
                <span class="material-icons">star</span>
                <span class="material-icons">star</span>
                <span class="material-icons">star</span>
                <span class="material-icons">star</span>
                <span class="material-icons">star</span>
            </div>
            {% elif review.bintang == 4 %}
            <div class="col-6 col-lg-2 mt-2 stars">
                <span class="material-icons">star</span>
                <span class="material-icons">star</span>
                <span class="material-icons">star</span>
                <span class="material-icons">star</span>
                <span class="material-icons">star_outline</span>
            </div>
            {% elif review.bintang == 3 %}
            <div class="col-6 col-lg-2 mt-2 stars">
                <span class="material-icons">star</span>
                <span class="material-icons">star</span>
                <span class="material-icons">star</span>
                <span class="material-icons">star_outline</span>
                <span class="material-icons">star_outline</span>
            </div>
            {% elif review.bintang == 2 %}
            <div class="col-6 col-lg-2 mt-2 stars">
                <span class="material-icons">star</span>
                <span class="material-icons">star</span>
                <span class="material-icons">star_outline</span>
                <span class="material-icons">star_outline</span>
                <span class="material-icons">star_outline</span>
            </div>
            {% else %}
            <div class="col-6 col-lg-2 mt-2 stars">
                <span class="material-icons">star</span>
                <span class="material-icons">star_outline</span>
                <span class="material-icons">star_outline</span>
                <span class="material-icons">star_outline</span>
                <span class="material-icons">star_outline</span>
            </div>
            {% endif %}
        </div>
        {% empty %}
        <h2 class="mb-5">Belum ada ulasan untuk barang ini.</h2>
        {% endfor %}
        {% if user.is_authenticated and alreadyWrote == False and bought == True %}
        <div class="row mb-5">
            <a href="{% url 'review:tulis' id=barang.id %}" class="btn-review btn btn-info btn-lg mt-5 pos-hero"><span>Tulis Ulasan</span></a>
        </div>
        {% else %}
        {% endif %}
    </div>
</div>
{% for message in messages %}
    {% if message.level == DEFAULT_MESSAGE_LEVELS.ERROR %}
        <script type="text/javascript" >
            var message = "{{message}}";
            Swal.fire({
                        icon: 'error',
                        title: 'Error',
                        text: `${message}`,
                    })
        </script>
    {% elif message.level == DEFAULT_MESSAGE_LEVELS.SUCCESS %}
        <script type="text/javascript" >
            var message = "{{message}}";
            Swal.fire({
                        icon: 'success',
                        title: 'Berhasil',
                        text: `${message}`,
                    })
        </script>
    {% endif %}
{% endfor %}
<script src="{% static 'js/detail-barang.js' %}"></script>
{% endblock content %}